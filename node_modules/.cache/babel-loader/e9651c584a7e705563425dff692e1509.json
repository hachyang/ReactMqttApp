{"ast":null,"code":"var _jsxFileName = \"/home/r1701/Downloads/react-mqtt-master/src/components/Hook/index.js\";\nimport React, { createContext, useEffect, useState } from 'react';\nimport Connection from './Connection';\nimport Publisher from './Publisher';\nimport Subscriber from './Subscriber';\nimport Receiver from './Receiver';\nimport mqtt from 'mqtt';\nexport const QosOption = createContext([]);\nconst qosOption = [{\n  label: '0',\n  value: 0\n}, {\n  label: '1',\n  value: 1\n}, {\n  label: '2',\n  value: 2\n}];\n\nconst HookMqtt = ({\n  userInfo\n}) => {\n  const [client, setClient] = useState(null);\n  const [isSubed, setIsSub] = useState(false);\n  const [payload, setPayload] = useState({});\n  const [connectStatus, setConnectStatus] = useState('Connect');\n\n  const mqttConnect = (host, mqttOption) => {\n    setConnectStatus('Connecting');\n    setClient(mqtt.connect(host, mqttOption));\n  };\n\n  useEffect(() => {\n    if (client) {\n      client.on('connect', () => {\n        setConnectStatus('Connected');\n      });\n      client.on('error', err => {\n        console.error('Connection error: ', err);\n        client.end();\n      });\n      client.on('reconnect', () => {\n        setConnectStatus('Reconnecting');\n      });\n      client.on('message', (topic, message) => {\n        const payload = {\n          topic,\n          message: message.toString()\n        };\n        setPayload(payload);\n      });\n    }\n  }, [client]);\n\n  const mqttDisconnect = () => {\n    if (client) {\n      client.end(() => {\n        setConnectStatus('Connect');\n      });\n    }\n  };\n\n  const mqttPublish = context => {\n    if (client) {\n      const {\n        topic,\n        qos,\n        payload\n      } = context;\n      client.publish(topic, payload, {\n        qos\n      }, error => {\n        if (error) {\n          console.log('Publish error: ', error);\n        }\n      });\n    }\n  };\n\n  const mqttSub = subscription => {\n    if (client) {\n      const {\n        topic,\n        qos\n      } = subscription;\n      client.subscribe(topic, {\n        qos\n      }, error => {\n        if (error) {\n          console.log('Subscribe to topics error', error);\n          return;\n        }\n\n        setIsSub(true);\n      });\n    }\n  };\n\n  const mqttUnSub = subscription => {\n    if (client) {\n      const {\n        topic\n      } = subscription;\n      client.unsubscribe(topic, error => {\n        if (error) {\n          console.log('Unsubscribe error', error);\n          return;\n        }\n\n        setIsSub(false);\n      });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Connection, {\n    connect: mqttConnect,\n    disconnect: mqttDisconnect,\n    connectBtn: connectStatus,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }\n  }, \"Device ID:\", userInfo.deviceID), /*#__PURE__*/React.createElement(\"a\", {\n    href: \"http://192.168.0.43:1880/ui\",\n    style: {\n      color: \"red\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 67\n    }\n  }, \"Go Home\")), /*#__PURE__*/React.createElement(QosOption.Provider, {\n    value: qosOption,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Subscriber, {\n    deviceID: userInfo.deviceID,\n    sub: mqttSub,\n    unSub: mqttUnSub,\n    showUnsub: isSubed,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Publisher, {\n    deviceID: userInfo.deviceID,\n    publish: mqttPublish,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Receiver, {\n    deviceIP: userInfo.deviceIP,\n    payload: payload,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default HookMqtt;","map":{"version":3,"sources":["/home/r1701/Downloads/react-mqtt-master/src/components/Hook/index.js"],"names":["React","createContext","useEffect","useState","Connection","Publisher","Subscriber","Receiver","mqtt","QosOption","qosOption","label","value","HookMqtt","userInfo","client","setClient","isSubed","setIsSub","payload","setPayload","connectStatus","setConnectStatus","mqttConnect","host","mqttOption","connect","on","err","console","error","end","topic","message","toString","mqttDisconnect","mqttPublish","context","qos","publish","log","mqttSub","subscription","subscribe","mqttUnSub","unsubscribe","deviceID","color","deviceIP"],"mappings":"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","sourcesContent":["import React, { createContext, useEffect, useState } from 'react';\nimport Connection from './Connection';\nimport Publisher from './Publisher';\nimport Subscriber from './Subscriber';\nimport Receiver from './Receiver';\nimport mqtt from 'mqtt';\n\nexport const QosOption = createContext([])\nconst qosOption = [\n  {\n    label: '0',\n    value: 0,\n  }, {\n    label: '1',\n    value: 1,\n  }, {\n    label: '2',\n    value: 2,\n  },\n];\n\nconst HookMqtt = ({userInfo}) => {\n  const [client, setClient] = useState(null);\n  const [isSubed, setIsSub] = useState(false);\n  const [payload, setPayload] = useState({});\n  const [connectStatus, setConnectStatus] = useState('Connect');\n\n  const mqttConnect = (host, mqttOption) => {\n    setConnectStatus('Connecting');\n    setClient(mqtt.connect(host, mqttOption));\n  };\n\n  useEffect(() => {\n    if (client) {\n      client.on('connect', () => {\n        setConnectStatus('Connected');\n      });\n      client.on('error', (err) => {\n        console.error('Connection error: ', err);\n        client.end();\n      });\n      client.on('reconnect', () => {\n        setConnectStatus('Reconnecting');\n      });\n      client.on('message', (topic, message) => {\n        const payload = { topic, message: message.toString() };\n        setPayload(payload);\n      });\n    }\n  }, [client]);\n\n  const mqttDisconnect = () => {\n    if (client) {\n      client.end(() => {\n        setConnectStatus('Connect');\n      });\n    }\n  }\n\n  const mqttPublish = (context) => {\n    if (client) {\n      const { topic, qos, payload } = context;\n      client.publish(topic, payload, { qos }, error => {\n        if (error) {\n          console.log('Publish error: ', error);\n        }\n      });\n    }\n  }\n\n  const mqttSub = (subscription) => {\n    if (client) {\n      const { topic, qos } = subscription;\n      client.subscribe(topic, { qos }, (error) => {\n        if (error) {\n          console.log('Subscribe to topics error', error)\n          return\n        }\n        setIsSub(true)\n      });\n    }\n  };\n\n  const mqttUnSub = (subscription) => {\n    if (client) {\n      const { topic } = subscription;\n      client.unsubscribe(topic, error => {\n        if (error) {\n          console.log('Unsubscribe error', error)\n          return\n        }\n        setIsSub(false);\n      });\n    }\n  };\n\n  return (\n    <>\n      <Connection connect={mqttConnect} disconnect={mqttDisconnect} connectBtn={connectStatus} />\n      <p>Device ID:{userInfo.deviceID}</p>\n      <a href=\"http://192.168.0.43:1880/ui\" style={{color:\"red\"}}><h1>Go Home</h1></a>\n      <QosOption.Provider value={qosOption}>\n        <Subscriber deviceID={userInfo.deviceID} sub={mqttSub} unSub={mqttUnSub} showUnsub={isSubed} />\n        <Publisher deviceID={userInfo.deviceID} publish={mqttPublish} />\n      </QosOption.Provider>\n      <Receiver deviceIP={userInfo.deviceIP} payload={payload}/>\n    </>\n  );\n}\n\nexport default HookMqtt;\n"]},"metadata":{},"sourceType":"module"}